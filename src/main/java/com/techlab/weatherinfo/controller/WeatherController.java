package com.techlab.weatherinfo.controller;

import com.techlab.weatherinfo.service.WeatherService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.enums.ParameterIn;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import static com.techlab.weatherinfo.constants.ApplicationConstants.X_CLIENT_ID;
import static com.techlab.weatherinfo.constants.ApplicationConstants.X_CLIENT_SECRET;

/**
 * The class WeatherController
 * <p>
 * This class is used to handle the weather related requests.
 */
@RestController
@RequestMapping("/weather")
public class WeatherController {

    @Autowired
    private WeatherService weatherService;

    @Parameter(in = ParameterIn.HEADER, name = X_CLIENT_ID, description = "Client ID", required = true, schema = @Schema(type = "string"), example = "CLIENT-295")
    @Parameter(in = ParameterIn.HEADER, name = X_CLIENT_SECRET, description = "Client Secret", required = true, schema = @Schema(type = "string"), example = "WAPI-295-dhUfvCnM6X2RbH7")
    @Operation(description = "Get forecast summary by location name")
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "Successfully retrieved forecast summary",
                    content = @Content(mediaType = "application/json", schema = @Schema(implementation = Object.class),
                            examples = {@ExampleObject(name = "example", value = "{\"title\":\"ForecastSummary\",\"type\":\"object\",\"properties\":{\"forecast\":{\"description\":\"WeatherInformationSummaryEntity\",\"title\":\"WeatherInformationsummaryEntity\",\"type\":\"object\",\"properties\":{\"forecastDate\":{\"description\":\"DateoflastupdateformatYYYY-mm-ddTHH:MM:SS\",\"format\":\"datetime\",\"type\":\"string\"},\"items\":{\"description\":\"Forecastsummaryperday\",\"type\":[\"array\",\"null\"],\"items\":{\"description\":\"ForecastSummaryEntity\",\"title\":\"ForecastSummaryEntity\",\"type\":\"object\",\"properties\":{\"astronomy\":{\"description\":\"Astronomy\",\"type\":\"object\",\"properties\":{\"dawn\":{\"type\":[\"string\",\"null\"]},\"dusk\":{\"type\":[\"string\",\"null\"]},\"moonphase\":{\"type\":[\"number\",\"null\"]},\"moonrise\":{\"type\":[\"string\",\"null\"]},\"moonset\":{\"type\":[\"string\",\"null\"]},\"moontransit\":{\"type\":[\"string\",\"null\"]},\"moonzodiac\":{\"type\":[\"integer\",\"null\"]},\"sunrise\":{\"type\":[\"string\",\"null\"]},\"sunset\":{\"type\":[\"string\",\"null\"]},\"suntransit\":{\"type\":[\"string\",\"null\"]}}},\"date\":{\"description\":\"ForecastdateformatYYYY-mm-dd\",\"format\":\"date\",\"type\":\"string\"},\"dateWithTimezone\":{\"description\":\"Datewithtimezoneinformation\",\"format\":\"datetime\",\"type\":\"string\"},\"freshSnow\":{\"description\":\"Freshsnow(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"prec\":{\"description\":\"Precipitation\",\"type\":\"object\",\"properties\":{\"class\":{\"description\":\"Precipitationclass(0:no,1:light,2:mid,3:heavy)\",\"type\":[\"integer\",\"null\"]},\"probability\":{\"description\":\"Propabilityofprecipitation(%)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"sum\":{\"description\":\"Totalprecipitation(l/m^2)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"sumAsRain\":{\"description\":\"Totalprecipitation(l/m^2)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"rainHours\":{\"description\":\"Rainduratiom(h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"snowHeight\":{\"description\":\"Snowheight(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"snowLine\":{\"description\":\"Snowfallline\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Snowfalllineaverage(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Snowfalllinemaximum(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Snowfalllineminimum(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"unit\":{\"type\":\"string\"}}},\"sunHours\":{\"description\":\"Sunduration(h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":\"number\"},\"temperature\":{\"description\":\"Temperature\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Temperatureaverage(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Temperaturemaximum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Temperatureminimum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"weather\":{\"description\":\"Weatherinformation(state,text,icon)\",\"type\":\"object\",\"properties\":{\"icon\":{\"description\":\"Weathericonforcalculatedinterpretation\",\"type\":[\"string\",\"null\"]},\"state\":{\"description\":\"Calculatedweatherinterpretation\",\"type\":[\"integer\",\"null\"]},\"text\":{\"description\":\"Shortweathertextforcalculatedinterpretation\",\"type\":[\"string\",\"null\"]}}},\"wind\":{\"description\":\"Wind\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Windaverage(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"direction\":{\"description\":\"Winddirection\",\"type\":[\"string\",\"null\"]},\"gusts\":{\"description\":\"GustInformation\",\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"},\"value\":{\"description\":\"Windgust(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":\"number\"}}},\"max\":{\"description\":\"Windmaximum(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Windminimum(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"significationWind\":{\"default\":false,\"description\":\"Issignification?\",\"type\":\"boolean\"},\"text\":{\"description\":\"Windtext\",\"type\":[\"string\",\"null\"]},\"unit\":{\"type\":\"string\"}}},\"windchill\":{\"description\":\"Windchill\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Windchillaverage(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Windchillmaximum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Windchillminimum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}}}}},\"nextUpdate\":{\"description\":\"DateofnextupdateformatYYYY-mm-ddTHH:MM:SS\",\"format\":\"datetime\",\"type\":\"string\"},\"point\":{\"default\":\"global\",\"description\":\"Namedelevationpoint\",\"enum\":[\"global\",\"lowestPoint\",\"highestPoint\",null],\"type\":[\"string\",\"null\"]},\"source\":{\"description\":\"Weatherdataprovider\",\"type\":\"string\"}}},\"location\":{\"description\":\"LocationInformantion\",\"title\":\"BaseLocation\",\"type\":\"object\",\"properties\":{\"code\":{\"description\":\"Locationcode\",\"type\":\"string\"},\"coordinates\":{\"description\":\"Coordinates\",\"type\":\"object\",\"properties\":{\"latitude\":{\"description\":\"Valuebetween-90and90.Latitudeasdecimaldegrees(upto5decimals)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"longitude\":{\"description\":\"Valuebetween-180and180.Longitudeasdecimaldegrees(upto5decimals)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"name\":{\"description\":\"NameoftheLocation\",\"type\":[\"string\",\"null\"]},\"timezone\":{\"description\":\"TimeZone\",\"type\":[\"string\",\"null\"]}}}}}")})),
            @ApiResponse(responseCode = "403", description = "Forbidden"),
            @ApiResponse(responseCode = "404", description = "Location not found"),
            @ApiResponse(responseCode = "500", description = "Internal server error"),
            @ApiResponse(responseCode = "401", description = "Unauthorized")
    })
    @GetMapping("/summary/{locationName}")
    public ResponseEntity<Object> getForecastSummaryByLocationName(
            @Parameter(description = "Name of the location for forecast summary", example = "Berlin")
            @PathVariable String locationName) {
        return weatherService.getForecastSummaryByLocationName(locationName);
    }

    @Parameter(in = ParameterIn.HEADER, name = X_CLIENT_ID, description = "Client ID", required = true, schema = @Schema(type = "string"), example = "CLIENT-295")
    @Parameter(in = ParameterIn.HEADER, name = X_CLIENT_SECRET, description = "Client Secret", required = true, schema = @Schema(type = "string"), example = "WAPI-295-dhUfvCnM6X2RbH7")
    @Operation(description = "Get hourly forecast by location name")
    @ApiResponses(value = {
            @ApiResponse(responseCode = "200", description = "Successfully retrieved hourly forecast",
                    content = @Content(mediaType = "application/json", schema = @Schema(implementation = Object.class),
                            examples = {@ExampleObject(name = "example", value = "{\"title\":\"ForecastHourly\",\"type\":\"object\",\"properties\":{\"forecast\":{\"description\":\"WeatherInformationHourlyEntity\",\"title\":\"WeatherInformationHourlyEntity\",\"type\":\"object\",\"properties\":{\"forecastDate\":{\"description\":\"DateoflastupdateformatYYYY-mm-ddTHH:MM:SS\",\"format\":\"datetime\",\"type\":\"string\"},\"items\":{\"description\":\"Forecastdetails\",\"type\":[\"array\",\"null\"],\"items\":{\"description\":\"ForecastDetailEntity\",\"title\":\"ForecastDetailEntity\",\"type\":\"object\",\"properties\":{\"clouds\":{\"description\":\"Cloudagein%(highclouds,lowclouds,middleclouds)\",\"type\":\"object\",\"properties\":{\"high\":{\"description\":\"highclouds(%)\",\"type\":[\"integer\",\"null\"]},\"low\":{\"description\":\"lowclouds(%)\",\"type\":[\"integer\",\"null\"]},\"middle\":{\"description\":\"middleclouds(%)\",\"type\":[\"integer\",\"null\"]}}},\"date\":{\"description\":\"Date,beginningoftimespan,formatYYYY-mm-ddTHH:MM:SSZ\",\"format\":\"datetime\",\"type\":\"string\"},\"freshSnow\":{\"description\":\"Freshsnow(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"isNight\":{\"description\":\"Isnight?\",\"type\":\"boolean\"},\"period\":{\"description\":\"Period(h)\",\"type\":[\"integer\",\"null\"]},\"prec\":{\"description\":\"Precipitation\",\"type\":\"object\",\"properties\":{\"class\":{\"description\":\"Precipitationclass(0:no,1:light,2:mid,3:heavy)\",\"type\":[\"integer\",\"null\"]},\"probability\":{\"description\":\"Propabilityofprecipitation(%)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"sum\":{\"description\":\"Totalprecipitation(l/m^2)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"sumAsRain\":{\"description\":\"Totalprecipitation(l/m^2)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"pressure\":{\"description\":\"AirPressureinNN(hPa)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"rainHours\":{\"description\":\"Rainduratiom(h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"relativeHumidity\":{\"description\":\"RelativeHumidity\",\"type\":[\"integer\",\"null\"]},\"snowLine\":{\"description\":\"Snowfallline\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Snowfalllineaverage(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Snowfalllinemaximum(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Snowfalllineminimum(m)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"unit\":{\"type\":\"string\"}}},\"sunHours\":{\"description\":\"Sunduration(h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"temperature\":{\"description\":\"Temperature\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Temperatureaverage(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Temperaturemaximum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Temperatureminimum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"weather\":{\"description\":\"Weatherinformation(state,text,icon)\",\"type\":\"object\",\"properties\":{\"icon\":{\"description\":\"Weathericonforcalculatedinterpretation\",\"type\":[\"string\",\"null\"]},\"state\":{\"description\":\"Calculatedweatherinterpretation\",\"type\":[\"integer\",\"null\"]},\"text\":{\"description\":\"Shortweathertextforcalculatedinterpretation\",\"type\":[\"string\",\"null\"]}}},\"wind\":{\"description\":\"Wind\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Windaverage(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"direction\":{\"description\":\"Winddirection\",\"type\":[\"string\",\"null\"]},\"gusts\":{\"description\":\"GustInformation\",\"type\":\"object\",\"properties\":{\"text\":{\"type\":\"string\"},\"value\":{\"description\":\"Windgust(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":\"number\"}}},\"max\":{\"description\":\"Windmaximum(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Windminimum(km/h)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"significationWind\":{\"default\":false,\"description\":\"Issignification?\",\"type\":\"boolean\"},\"text\":{\"description\":\"Windtext\",\"type\":[\"string\",\"null\"]},\"unit\":{\"type\":\"string\"}}},\"windchill\":{\"description\":\"Windchill\",\"type\":\"object\",\"properties\":{\"avg\":{\"description\":\"Windchillaverage(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"max\":{\"description\":\"Windchillmaximum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"min\":{\"description\":\"Windchillminimum(°C)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}}}}},\"nextUpdate\":{\"description\":\"DateofnextupdateformatYYYY-mm-ddTHH:MM:SS\",\"format\":\"datetime\",\"type\":\"string\"},\"point\":{\"default\":\"global\",\"description\":\"Namedelevationpoint\",\"enum\":[\"global\",\"lowestPoint\",\"highestPoint\",null],\"type\":[\"string\",\"null\"]},\"source\":{\"description\":\"Weatherdataprovider\",\"type\":\"string\"}}},\"location\":{\"description\":\"LocationInformantion\",\"title\":\"BaseLocation\",\"type\":\"object\",\"properties\":{\"code\":{\"description\":\"Locationcode\",\"type\":\"string\"},\"coordinates\":{\"description\":\"Coordinates\",\"type\":\"object\",\"properties\":{\"latitude\":{\"description\":\"Valuebetween-90and90.Latitudeasdecimaldegrees(upto5decimals)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]},\"longitude\":{\"description\":\"Valuebetween-180and180.Longitudeasdecimaldegrees(upto5decimals)\",\"format\":\"float\",\"maximum\":3.402823669209385e+38,\"minimum\":-3.402823669209385e+38,\"type\":[\"number\",\"null\"]}}},\"name\":{\"description\":\"NameoftheLocation\",\"type\":[\"string\",\"null\"]},\"timezone\":{\"description\":\"TimeZone\",\"type\":[\"string\",\"null\"]}}}}}")})),
            @ApiResponse(responseCode = "403", description = "Forbidden"),
            @ApiResponse(responseCode = "404", description = "Location not found"),
            @ApiResponse(responseCode = "500", description = "Internal server error"),
            @ApiResponse(responseCode = "401", description = "Unauthorized")
    })
    @GetMapping("/hourly/{locationName}")
    public ResponseEntity<Object> getHourlyForecastByLocationName(
            @Parameter(description = "Name of the location for hourly forecast", example = "Berlin")
            @PathVariable String locationName) {
        return weatherService.getHourlyForecastByLocationName(locationName);
    }
}
